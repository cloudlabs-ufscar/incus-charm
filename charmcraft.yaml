# This file configures Charmcraft.
# See https://juju.is/docs/sdk/charmcraft-config for guidance.

# (Required)
name: incus


# (Required)
type: charm


# (Recommended)
title: Incus Charm


# (Required)
summary: Charmed Incus.


# (Required)
description: |
  The charm is an automated way to deploy and operate Incus.

  The charm deploys an Incus cluster across all units. Integrations with
  external network and storage services such as Ceph and OVN is provided,
  as well as integrations with auth and monitoring services.

  Incus can be used as a replacement for LXD or, depending on the use case,
  even more sophisticated solutions such as OpenStack. The charm provides an
  automated way of deploying and operating Incus.

  The charm is useful for operators who wish to deploy and operate Incus.


# (Required for 'charm' type)
bases:
  - build-on:
    - name: ubuntu
      channel: "22.04"
    run-on:
    - name: ubuntu
      channel: "22.04"


# (Optional) Configuration options for the charm
# This config section defines charm config options, and populates the Configure
# tab on Charmhub.
# More information on this section at https://juju.is/docs/sdk/charmcraft-yaml#heading--config
# General configuration documentation: https://juju.is/docs/sdk/config
config:
  options:
    # An example config option to customise the log level of the workload
    server_port:
      description: |
        Configures the port for the Incus API server.
      default: 8443
      type: int

actions:
  add-trusted-certificate:
    description: Add a trusted certificate to the Incus daemon.
    params:
      name:
        description: The certificate name (optional)
        type: string
      projects:
        description: A comma separated list of projects to restrict the client certificate to (optional)
        type: string
      cert:
        description: |
          The raw X.509 PEM client certificate.

          The file can be passed as:
          $ juju run incus/leader add-trusted-certificate cert="$(cat client.crt)"
        type: string
    required:
      - cert
    additionalProperties: false

extra-bindings:
  public:

parts:
  charm:
    build-packages:
      - build-essential
      - libffi-dev
      - libssl-dev
      - python3-dev
    build-snaps:
      - rustup
    override-build: |
      rustup default stable
      craftctl default
